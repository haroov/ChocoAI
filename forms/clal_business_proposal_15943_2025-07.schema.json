{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://schemas.example.local/clal/business_proposal/15943-2025-07.json",
  "title": "Clal - Business Proposal Form (מק\"ט 15943 07/2025) - jsonb intake schema",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "meta",
    "applicant",
    "business",
    "policy_term",
    "billing",
    "locations",
    "coverages"
  ],
  "$defs": {
    "ils_amount": {
      "type": "integer",
      "minimum": 0,
      "description": "Amount in ILS (ש\"ח), integer."
    },
    "percent": {
      "type": "number",
      "minimum": 0,
      "maximum": 1
    },
    "date": {
      "type": "string",
      "format": "date"
    },
    "datetime": {
      "type": "string",
      "format": "date-time"
    },
    "phone": {
      "type": "string",
      "minLength": 3,
      "maxLength": 30
    },
    "email": {
      "type": "string",
      "format": "email"
    },
    "yes_no_details": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "answer"
      ],
      "properties": {
        "answer": {
          "type": "boolean"
        },
        "details": {
          "type": "string",
          "maxLength": 2000
        }
      }
    },
    "address_il": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "city": {
          "type": "string",
          "maxLength": 100
        },
        "street": {
          "type": "string",
          "maxLength": 120
        },
        "house_number": {
          "type": "string",
          "maxLength": 20
        },
        "entrance": {
          "type": "string",
          "maxLength": 20
        },
        "apartment": {
          "type": "string",
          "maxLength": 20
        },
        "pobox": {
          "type": "string",
          "maxLength": 20
        },
        "zip_code": {
          "type": "string",
          "maxLength": 15
        }
      }
    },
    "attachment": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "type"
      ],
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "business_license",
            "fire_department_approval",
            "equipment_list",
            "vendors_list",
            "other"
          ]
        },
        "description": {
          "type": "string",
          "maxLength": 300
        },
        "file_ref": {
          "type": "string",
          "maxLength": 300
        },
        "received": {
          "type": "boolean",
          "default": false
        }
      }
    }
  },
  "properties": {
    "meta": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "insurer",
        "form_catalog_number",
        "form_version_date",
        "source_document"
      ],
      "properties": {
        "insurer": {
          "type": "string",
          "const": "clal"
        },
        "form_catalog_number": {
          "type": "string",
          "const": "15943"
        },
        "form_version_date": {
          "type": "string",
          "const": "2025-07"
        },
        "source_document": {
          "type": "string",
          "const": "טופס-הצעה-לביטוח-בית-עסק.pdf"
        },
        "created_at": {
          "$ref": "#/$defs/datetime"
        },
        "updated_at": {
          "$ref": "#/$defs/datetime"
        },
        "status": {
          "type": "string",
          "enum": [
            "draft",
            "submitted",
            "bound",
            "declined"
          ],
          "default": "draft"
        }
      }
    },
    "agent": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "region": {
          "type": "string",
          "maxLength": 80
        },
        "agent_name": {
          "type": "string",
          "maxLength": 120
        },
        "agent_team": {
          "type": "string",
          "maxLength": 120
        },
        "agent_number": {
          "type": "string",
          "maxLength": 30
        }
      }
    },
    "applicant": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "contact",
        "relationship_to_business"
      ],
      "properties": {
        "person": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "first_name": {
              "type": "string",
              "maxLength": 80
            },
            "last_name": {
              "type": "string",
              "maxLength": 80
            },
            "national_id": {
              "type": "string",
              "maxLength": 20
            }
          }
        },
        "contact": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "mobile": {
              "$ref": "#/$defs/phone"
            },
            "phone": {
              "$ref": "#/$defs/phone"
            },
            "fax": {
              "$ref": "#/$defs/phone"
            },
            "email": {
              "$ref": "#/$defs/email"
            }
          }
        },
        "home_address": {
          "$ref": "#/$defs/address_il"
        },
        "relationship_to_business": {
          "type": "string",
          "enum": [
            "owner",
            "partner",
            "director",
            "authorized_signatory",
            "other"
          ]
        }
      }
    },
    "business": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "name",
        "legal_entity_type",
        "registration_id",
        "business_type"
      ],
      "properties": {
        "name": {
          "type": "string",
          "maxLength": 200
        },
        "legal_entity_type": {
          "type": "string",
          "enum": [
            "private_company",
            "public_company",
            "registered_partnership",
            "authorized_dealer",
            "small_dealer",
            "other"
          ]
        },
        "registration_id": {
          "type": "string",
          "maxLength": 30,
          "description": "ת.ז./ח.פ./ח.צ."
        },
        "contact": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "mobile": {
              "$ref": "#/$defs/phone"
            },
            "phone": {
              "$ref": "#/$defs/phone"
            },
            "fax": {
              "$ref": "#/$defs/phone"
            },
            "email": {
              "$ref": "#/$defs/email"
            }
          }
        },
        "has_additional_locations": {
          "type": "boolean"
        },
        "additional_locations_count": {
          "type": "integer",
          "minimum": 0
        },
        "business_type": {
          "type": "string",
          "enum": [
            "office",
            "store",
            "workshop",
            "factory",
            "warehouse",
            "other"
          ]
        },
        "business_type_other": {
          "type": "string",
          "maxLength": 200
        },
        "business_use": {
          "type": "string",
          "maxLength": 1000,
          "description": "העסק משמש ל- / פעילות בית העסק ומוצריו"
        }
      },
      "allOf": [
        {
          "if": {
            "properties": {
              "business_type": {
                "const": "other"
              }
            }
          },
          "then": {
            "required": [
              "business_type_other"
            ]
          }
        }
      ]
    },
    "policy_term": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "start_date",
        "end_date"
      ],
      "properties": {
        "start_date": {
          "$ref": "#/$defs/date"
        },
        "end_date": {
          "$ref": "#/$defs/date"
        },
        "end_time_local": {
          "type": "string",
          "default": "24:00",
          "description": "Form states end 'בחצות'."
        }
      }
    },
    "billing": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "collection_method"
      ],
      "properties": {
        "collection_method": {
          "type": "string",
          "enum": [
            "regular",
            "standing_order",
            "credit_card"
          ]
        },
        "payments_count": {
          "type": "integer",
          "minimum": 1,
          "maximum": 36
        },
        "notes": {
          "type": "string",
          "maxLength": 500
        }
      }
    },
    "locations": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "address",
          "building_info"
        ],
        "properties": {
          "location_id": {
            "type": "string",
            "maxLength": 50
          },
          "address": {
            "$ref": "#/$defs/address_il"
          },
          "building_info": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "relationship_to_building": {
                "type": "string",
                "enum": [
                  "owner",
                  "tenant",
                  "long_term_lessee"
                ]
              },
              "year_built": {
                "type": "integer",
                "minimum": 1800,
                "maximum": 2100
              },
              "floor": {
                "type": "integer",
                "minimum": -10,
                "maximum": 200
              },
              "total_floors": {
                "type": "integer",
                "minimum": 1,
                "maximum": 200
              },
              "area_sqm": {
                "type": "number",
                "minimum": 1
              },
              "construction_materials": {
                "type": "array",
                "items": {
                  "type": "string",
                  "enum": [
                    "stone",
                    "brick",
                    "concrete",
                    "tin_sheet",
                    "wood",
                    "other"
                  ]
                },
                "uniqueItems": true
              },
              "construction_other": {
                "type": "string",
                "maxLength": 200
              },
              "roof_type": {
                "type": "array",
                "items": {
                  "type": "string",
                  "enum": [
                    "concrete",
                    "tiles",
                    "tin_sheet",
                    "asbestos",
                    "other"
                  ]
                },
                "uniqueItems": true
              },
              "roof_other": {
                "type": "string",
                "maxLength": 200
              },
              "pal_kal_construction": {
                "$ref": "#/$defs/yes_no_details"
              }
            }
          },
          "surroundings": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "description": {
                "type": "string",
                "maxLength": 2000
              },
              "neighboring_businesses": {
                "type": "string",
                "maxLength": 2000
              },
              "hazardous_goods_nearby": {
                "$ref": "#/$defs/yes_no_details"
              },
              "shared_wall_with_neighbors": {
                "$ref": "#/$defs/yes_no_details"
              }
            }
          },
          "liens": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "required": {
                "type": "boolean"
              },
              "building_lien": {
                "type": "object",
                "additionalProperties": false,
                "properties": {
                  "beneficiary": {
                    "type": "string",
                    "maxLength": 200
                  },
                  "branch_number": {
                    "type": "string",
                    "maxLength": 20
                  },
                  "beneficiary_address": {
                    "type": "string",
                    "maxLength": 200
                  },
                  "amount_ils": {
                    "$ref": "#/$defs/ils_amount"
                  }
                }
              },
              "contents_lien": {
                "type": "object",
                "additionalProperties": false,
                "properties": {
                  "beneficiary": {
                    "type": "string",
                    "maxLength": 200
                  },
                  "branch_number": {
                    "type": "string",
                    "maxLength": 20
                  },
                  "beneficiary_address": {
                    "type": "string",
                    "maxLength": 200
                  },
                  "amount_ils": {
                    "$ref": "#/$defs/ils_amount"
                  }
                }
              }
            }
          },
          "licenses": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "business_license_in_force": {
                "$ref": "#/$defs/yes_no_details"
              },
              "fire_department_approval_in_force": {
                "$ref": "#/$defs/yes_no_details"
              }
            }
          },
          "risk_and_security": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "requires_insurance_policy_pledge": {
                "$ref": "#/$defs/yes_no_details"
              },
              "fire_protection": {
                "type": "object",
                "additionalProperties": false,
                "properties": {
                  "fire_extinguishers": {
                    "$ref": "#/$defs/yes_no_details"
                  },
                  "fire_hose_reels": {
                    "$ref": "#/$defs/yes_no_details"
                  },
                  "smoke_detectors": {
                    "$ref": "#/$defs/yes_no_details"
                  },
                  "sprinklers": {
                    "$ref": "#/$defs/yes_no_details"
                  },
                  "fire_department_inspection": {
                    "$ref": "#/$defs/yes_no_details"
                  },
                  "negative_findings": {
                    "$ref": "#/$defs/yes_no_details"
                  }
                }
              },
              "burglary_protection": {
                "type": "object",
                "additionalProperties": false,
                "properties": {
                  "doors_and_locks_description": {
                    "type": "string",
                    "maxLength": 2000
                  },
                  "windows_protection_description": {
                    "type": "string",
                    "maxLength": 2000
                  },
                  "alarm_system": {
                    "$ref": "#/$defs/yes_no_details"
                  }
                }
              },
              "water_flood_risk": {
                "type": "object",
                "additionalProperties": false,
                "properties": {
                  "nearby_flood_source": {
                    "$ref": "#/$defs/yes_no_details"
                  },
                  "below_ground_parts": {
                    "$ref": "#/$defs/yes_no_details"
                  },
                  "water_main_location_and_age": {
                    "type": "string",
                    "maxLength": 500
                  },
                  "previous_flooding_events_last_3_years": {
                    "$ref": "#/$defs/yes_no_details"
                  }
                }
              }
            }
          }
        }
      }
    },
    "coverages": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "property",
        "liability",
        "annexes"
      ],
      "properties": {
        "property": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "by_location": {
              "type": "array",
              "minItems": 1,
              "items": {
                "type": "object",
                "additionalProperties": false,
                "required": [
                  "location_id",
                  "chapter_1_contents",
                  "chapter_2_building",
                  "business_interruption",
                  "chapter_4_burglary",
                  "chapter_5_money"
                ],
                "properties": {
                  "location_id": {
                    "type": "string",
                    "maxLength": 50
                  },
                  "chapter_1_contents": {
                    "type": "object",
                    "additionalProperties": false,
                    "required": [
                      "selected"
                    ],
                    "properties": {
                      "selected": {
                        "type": "boolean"
                      },
                      "sum_insured_contents_excl_stock_ils": {
                        "$ref": "#/$defs/ils_amount"
                      },
                      "sum_insured_stock_ils": {
                        "$ref": "#/$defs/ils_amount"
                      },
                      "stock_basis": {
                        "type": "string",
                        "enum": [
                          "full",
                          "declaration_basis",
                          "first_loss",
                          "not_applicable"
                        ]
                      },
                      "sum_insured_building_fixtures_ils": {
                        "$ref": "#/$defs/ils_amount",
                        "description": "צמודי מבנה השייכים למציע (בערך כינון)"
                      },
                      "earthquake": {
                        "type": "boolean"
                      },
                      "nature_perils": {
                        "type": "boolean"
                      },
                      "fridge_spoilage": {
                        "type": "object",
                        "additionalProperties": false,
                        "properties": {
                          "selected": {
                            "type": "boolean"
                          },
                          "sum_insured_ils": {
                            "$ref": "#/$defs/ils_amount"
                          }
                        }
                      }
                    }
                  },
                  "chapter_2_building": {
                    "type": "object",
                    "additionalProperties": false,
                    "required": [
                      "selected"
                    ],
                    "properties": {
                      "selected": {
                        "type": "boolean"
                      },
                      "sum_insured_building_ils": {
                        "$ref": "#/$defs/ils_amount",
                        "description": "ערך כינון"
                      },
                      "earthquake": {
                        "type": "boolean"
                      },
                      "nature_perils": {
                        "type": "boolean"
                      }
                    }
                  },
                  "business_interruption": {
                    "type": "object",
                    "additionalProperties": false,
                    "required": [
                      "type"
                    ],
                    "properties": {
                      "type": {
                        "type": "string",
                        "enum": [
                          "none",
                          "chapter_3a_daily_comp",
                          "chapter_3b_gross_profit"
                        ]
                      },
                      "chapter_3a_daily_comp": {
                        "type": "object",
                        "additionalProperties": false,
                        "properties": {
                          "selected": {
                            "type": "boolean"
                          },
                          "daily_max_compensation_ils": {
                            "$ref": "#/$defs/ils_amount",
                            "maximum": 5000
                          },
                          "max_compensation_days": {
                            "type": "integer",
                            "minimum": 1,
                            "maximum": 100
                          }
                        }
                      },
                      "chapter_3b_gross_profit": {
                        "type": "object",
                        "additionalProperties": false,
                        "properties": {
                          "selected": {
                            "type": "boolean"
                          },
                          "sum_insured_gross_profit_annual_ils": {
                            "$ref": "#/$defs/ils_amount"
                          },
                          "max_indemnity_period_months": {
                            "type": "integer",
                            "enum": [
                              3,
                              6,
                              9,
                              12,
                              15,
                              18
                            ]
                          },
                          "annual_turnover_ils": {
                            "$ref": "#/$defs/ils_amount"
                          },
                          "annual_fixed_expenses_ils": {
                            "$ref": "#/$defs/ils_amount"
                          },
                          "annual_net_profit_ils": {
                            "$ref": "#/$defs/ils_amount"
                          },
                          "claim_preparation_expenses": {
                            "type": "object",
                            "additionalProperties": false,
                            "properties": {
                              "selected": {
                                "type": "boolean"
                              },
                              "max_amount_ils": {
                                "$ref": "#/$defs/ils_amount",
                                "maximum": 200000
                              }
                            }
                          }
                        }
                      }
                    },
                    "allOf": [
                      {
                        "if": {
                          "properties": {
                            "type": {
                              "const": "chapter_3a_daily_comp"
                            }
                          }
                        },
                        "then": {
                          "required": [
                            "chapter_3a_daily_comp"
                          ],
                          "properties": {
                            "chapter_3a_daily_comp": {
                              "properties": {
                                "selected": {
                                  "const": true
                                }
                              }
                            }
                          }
                        }
                      },
                      {
                        "if": {
                          "properties": {
                            "type": {
                              "const": "chapter_3b_gross_profit"
                            }
                          }
                        },
                        "then": {
                          "required": [
                            "chapter_3b_gross_profit"
                          ],
                          "properties": {
                            "chapter_3b_gross_profit": {
                              "properties": {
                                "selected": {
                                  "const": true
                                }
                              }
                            }
                          }
                        }
                      },
                      {
                        "if": {
                          "properties": {
                            "type": {
                              "const": "none"
                            }
                          }
                        },
                        "then": {
                          "properties": {
                            "chapter_3a_daily_comp": {
                              "properties": {
                                "selected": {
                                  "const": false
                                }
                              }
                            },
                            "chapter_3b_gross_profit": {
                              "properties": {
                                "selected": {
                                  "const": false
                                }
                              }
                            }
                          }
                        }
                      }
                    ]
                  },
                  "chapter_4_burglary": {
                    "type": "object",
                    "additionalProperties": false,
                    "required": [
                      "selected"
                    ],
                    "properties": {
                      "selected": {
                        "type": "boolean"
                      },
                      "basis": {
                        "type": "string",
                        "enum": [
                          "full_contents_sum",
                          "first_loss"
                        ]
                      },
                      "sum_insured_ils": {
                        "$ref": "#/$defs/ils_amount",
                        "description": "If basis=first_loss, provide amount; if full, can be omitted and derived from contents sum."
                      }
                    }
                  },
                  "chapter_5_money": {
                    "type": "object",
                    "additionalProperties": false,
                    "required": [
                      "selected"
                    ],
                    "properties": {
                      "selected": {
                        "type": "boolean"
                      },
                      "in_safe_ils": {
                        "$ref": "#/$defs/ils_amount"
                      },
                      "in_transit_ils": {
                        "$ref": "#/$defs/ils_amount"
                      }
                    }
                  },
                  "chapter_6_goods_in_transit": {
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                      "selected": {
                        "type": "boolean"
                      },
                      "sum_per_conveyance_ils": {
                        "$ref": "#/$defs/ils_amount"
                      },
                      "annual_aggregate_ils": {
                        "$ref": "#/$defs/ils_amount"
                      },
                      "includes_burglary": {
                        "type": "boolean"
                      },
                      "includes_robbery": {
                        "type": "boolean"
                      },
                      "vehicles": {
                        "type": "array",
                        "items": {
                          "type": "object",
                          "additionalProperties": false,
                          "properties": {
                            "vehicle_description": {
                              "type": "string",
                              "maxLength": 200
                            },
                            "license_plate": {
                              "type": "string",
                              "maxLength": 20
                            },
                            "security_measures": {
                              "type": "string",
                              "maxLength": 500
                            }
                          }
                        }
                      }
                    }
                  },
                  "chapter_10_electronic_equipment": {
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                      "selected": {
                        "type": "boolean"
                      },
                      "coverage_type": {
                        "type": "string",
                        "enum": [
                          "full",
                          "residual"
                        ]
                      },
                      "sum_insured_total_ils": {
                        "$ref": "#/$defs/ils_amount"
                      },
                      "equipment_list_attached": {
                        "type": "boolean"
                      },
                      "items": {
                        "type": "array",
                        "items": {
                          "type": "object",
                          "additionalProperties": false,
                          "required": [
                            "description",
                            "replacement_value_new_ils"
                          ],
                          "properties": {
                            "description": {
                              "type": "string",
                              "maxLength": 300
                            },
                            "replacement_value_new_ils": {
                              "$ref": "#/$defs/ils_amount"
                            }
                          }
                        }
                      },
                      "mobile_equipment": {
                        "type": "object",
                        "additionalProperties": false,
                        "properties": {
                          "selected": {
                            "type": "boolean"
                          },
                          "description": {
                            "type": "string",
                            "maxLength": 300
                          },
                          "sum_insured_ils": {
                            "$ref": "#/$defs/ils_amount"
                          }
                        }
                      },
                      "service_contract_in_place": {
                        "$ref": "#/$defs/yes_no_details"
                      },
                      "data_recovery": {
                        "type": "object",
                        "additionalProperties": false,
                        "properties": {
                          "selected": {
                            "type": "boolean"
                          },
                          "storage_media_location": {
                            "type": "string",
                            "enum": [
                              "computer_room",
                              "separate_room",
                              "another_building",
                              "another_address",
                              "unknown"
                            ]
                          },
                          "storage_method": {
                            "type": "string",
                            "enum": [
                              "steel_cabinet",
                              "fireproof_cabinet",
                              "other"
                            ]
                          },
                          "storage_method_other": {
                            "type": "string",
                            "maxLength": 200
                          },
                          "ups_present": {
                            "type": "boolean"
                          },
                          "backup_frequency": {
                            "type": "string",
                            "enum": [
                              "daily",
                              "every_2_days",
                              "weekly",
                              "biweekly",
                              "other"
                            ]
                          },
                          "backup_frequency_other": {
                            "type": "string",
                            "maxLength": 100
                          }
                        }
                      },
                      "extra_operational_expenses": {
                        "type": "object",
                        "additionalProperties": false,
                        "properties": {
                          "selected": {
                            "type": "boolean"
                          },
                          "sum_insured_ils": {
                            "$ref": "#/$defs/ils_amount"
                          },
                          "indemnity_period_days": {
                            "type": "integer",
                            "enum": [
                              30,
                              90,
                              180,
                              270,
                              360
                            ]
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "liability": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "chapter_7_third_party": {
              "type": "object",
              "additionalProperties": false,
              "required": [
                "selected"
              ],
              "properties": {
                "selected": {
                  "type": "boolean"
                },
                "limit_per_event_ils": {
                  "$ref": "#/$defs/ils_amount",
                  "minimum": 500000,
                  "maximum": 10000000,
                  "multipleOf": 500000
                },
                "limit_aggregate_ils": {
                  "$ref": "#/$defs/ils_amount",
                  "minimum": 500000,
                  "maximum": 10000000,
                  "multipleOf": 500000
                }
              }
            },
            "chapter_8_employers_liability": {
              "type": "object",
              "additionalProperties": false,
              "required": [
                "selected"
              ],
              "properties": {
                "selected": {
                  "type": "boolean"
                },
                "limit_per_event_ils": {
                  "$ref": "#/$defs/ils_amount",
                  "default": 20000000
                },
                "limit_aggregate_ils": {
                  "$ref": "#/$defs/ils_amount",
                  "default": 20000000
                },
                "rating_basis": {
                  "type": "string",
                  "enum": [
                    "employee_count",
                    "annual_payroll",
                    "both"
                  ]
                },
                "employees": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "additionalProperties": false,
                    "required": [
                      "occupation_group"
                    ],
                    "properties": {
                      "occupation_group": {
                        "type": "string",
                        "maxLength": 100
                      },
                      "employee_count": {
                        "type": "integer",
                        "minimum": 0,
                        "maximum": 5000
                      },
                      "annual_payroll_ils": {
                        "$ref": "#/$defs/ils_amount"
                      }
                    }
                  }
                }
              }
            },
            "chapter_9_product_liability": {
              "type": "object",
              "additionalProperties": false,
              "required": [
                "selected"
              ],
              "properties": {
                "selected": {
                  "type": "boolean"
                },
                "limit_per_event_ils": {
                  "$ref": "#/$defs/ils_amount"
                },
                "limit_aggregate_ils": {
                  "$ref": "#/$defs/ils_amount"
                },
                "retroactive_date": {
                  "$ref": "#/$defs/date"
                },
                "insured_role": {
                  "type": "array",
                  "items": {
                    "type": "string",
                    "enum": [
                      "importer",
                      "exporter",
                      "manufacturer",
                      "assembler",
                      "distributor",
                      "other"
                    ]
                  },
                  "uniqueItems": true
                },
                "insured_role_other": {
                  "type": "string",
                  "maxLength": 200
                },
                "product_description": {
                  "type": "string",
                  "maxLength": 2000
                },
                "product_usage": {
                  "type": "string",
                  "maxLength": 2000
                },
                "territory": {
                  "type": "string",
                  "enum": [
                    "israel_only",
                    "worldwide_excl_us_canada",
                    "worldwide_incl_us_canada"
                  ]
                },
                "annual_turnover": {
                  "type": "object",
                  "additionalProperties": false,
                  "properties": {
                    "israel_ils": {
                      "$ref": "#/$defs/ils_amount"
                    },
                    "worldwide_excl_us_canada_ils": {
                      "$ref": "#/$defs/ils_amount"
                    },
                    "us_canada_ils": {
                      "$ref": "#/$defs/ils_amount"
                    },
                    "total_ils": {
                      "$ref": "#/$defs/ils_amount"
                    }
                  }
                },
                "product_has_instructions_and_warnings": {
                  "$ref": "#/$defs/yes_no_details"
                },
                "hazardous_properties": {
                  "type": "array",
                  "items": {
                    "type": "string",
                    "enum": [
                      "flammable",
                      "explosive",
                      "toxic",
                      "pressurized",
                      "other"
                    ]
                  },
                  "uniqueItems": true
                },
                "hazardous_properties_other": {
                  "type": "string",
                  "maxLength": 200
                },
                "used_in_vehicle": {
                  "$ref": "#/$defs/yes_no_details"
                },
                "is_new_product": {
                  "$ref": "#/$defs/yes_no_details"
                },
                "has_quality_control_process": {
                  "$ref": "#/$defs/yes_no_details"
                },
                "regulatory_approvals": {
                  "$ref": "#/$defs/yes_no_details"
                },
                "claims_history_last_5_years": {
                  "$ref": "#/$defs/yes_no_details"
                },
                "vendors_endorsement": {
                  "type": "object",
                  "additionalProperties": false,
                  "properties": {
                    "selected": {
                      "type": "boolean"
                    },
                    "vendor_name": {
                      "type": "string",
                      "maxLength": 200
                    },
                    "vendor_address": {
                      "type": "string",
                      "maxLength": 200
                    },
                    "product_type": {
                      "type": "string",
                      "maxLength": 200
                    },
                    "product_use": {
                      "type": "string",
                      "maxLength": 200
                    }
                  }
                },
                "discovery_period_months": {
                  "type": "integer",
                  "enum": [
                    6
                  ]
                },
                "delivered_works": {
                  "type": "object",
                  "additionalProperties": false,
                  "properties": {
                    "selected": {
                      "type": "boolean"
                    },
                    "work_type": {
                      "type": "string",
                      "maxLength": 300
                    },
                    "delivered_works_volume_ils": {
                      "$ref": "#/$defs/ils_amount"
                    }
                  }
                }
              },
              "allOf": [
                {
                  "if": {
                    "properties": {
                      "insured_role": {
                        "contains": {
                          "const": "other"
                        }
                      }
                    }
                  },
                  "then": {
                    "required": [
                      "insured_role_other"
                    ]
                  }
                }
              ]
            }
          }
        },
        "annexes": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "annex_a_cyber": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "selected": {
                  "type": "boolean"
                },
                "eligibility": {
                  "type": "object",
                  "additionalProperties": false,
                  "properties": {
                    "min_contents_sum_ils": {
                      "$ref": "#/$defs/ils_amount",
                      "const": 100000
                    },
                    "max_annual_turnover_ils": {
                      "$ref": "#/$defs/ils_amount",
                      "const": 50000000
                    }
                  }
                },
                "limit_per_claim_and_period_ils": {
                  "$ref": "#/$defs/ils_amount",
                  "default": 350000
                },
                "sublimit_first_party_ils": {
                  "$ref": "#/$defs/ils_amount",
                  "default": 100000
                },
                "system_security": {
                  "type": "object",
                  "additionalProperties": false,
                  "properties": {
                    "firewall_installed": {
                      "type": "boolean"
                    },
                    "antivirus_installed": {
                      "type": "boolean"
                    },
                    "wifi_protection": {
                      "type": "boolean"
                    },
                    "backups_exist": {
                      "type": "boolean"
                    },
                    "backup_frequency": {
                      "type": "string",
                      "enum": [
                        "daily",
                        "every_2_days",
                        "weekly",
                        "biweekly",
                        "other"
                      ]
                    },
                    "backup_frequency_other": {
                      "type": "string",
                      "maxLength": 100
                    }
                  }
                },
                "cyber_incidents_last_5_years": {
                  "type": "object",
                  "additionalProperties": false,
                  "properties": {
                    "had_security_breach_or_data_event": {
                      "$ref": "#/$defs/yes_no_details"
                    },
                    "insurer_declined_or_special_terms": {
                      "$ref": "#/$defs/yes_no_details"
                    }
                  }
                }
              }
            },
            "annex_b_terror_above_property_tax": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "selected": {
                  "type": "boolean"
                },
                "property_damage_basis": {
                  "type": "string",
                  "enum": [
                    "full_sum_insured",
                    "first_loss_over_10m"
                  ],
                  "default": "full_sum_insured"
                },
                "first_loss_amount_ils": {
                  "$ref": "#/$defs/ils_amount"
                },
                "includes_business_interruption": {
                  "type": "boolean"
                },
                "business_interruption_type": {
                  "type": "string",
                  "enum": [
                    "daily_comp",
                    "gross_profit"
                  ],
                  "description": "Must match selected BI type in the main cover."
                }
              }
            }
          }
        }
      }
    },
    "history_and_disclosures": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "business_name_changed_last_5_years": {
          "$ref": "#/$defs/yes_no_details"
        },
        "ownership_changed_last_5_years": {
          "$ref": "#/$defs/yes_no_details"
        },
        "claims_last_5_years": {
          "$ref": "#/$defs/yes_no_details"
        },
        "received_threats_or_malicious_damage_last_5_years": {
          "$ref": "#/$defs/yes_no_details"
        },
        "burglary_or_attempt_last_5_years": {
          "$ref": "#/$defs/yes_no_details"
        },
        "arson_or_attempt_last_5_years": {
          "$ref": "#/$defs/yes_no_details"
        },
        "risk_mitigation_taken": {
          "$ref": "#/$defs/yes_no_details"
        },
        "currently_insured_elsewhere": {
          "$ref": "#/$defs/yes_no_details"
        },
        "insurer_refused_or_cancelled_or_special_terms_last_5_years": {
          "$ref": "#/$defs/yes_no_details"
        }
      }
    },
    "communications_consents": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "operational_mail_delivery": {
          "type": "string",
          "enum": [
            "digital",
            "regular_mail"
          ],
          "default": "digital"
        },
        "marketing_consent": {
          "type": "boolean"
        },
        "marketing_opt_out_phone_voicemail": {
          "type": "string",
          "maxLength": 50,
          "description": "Opt-out phone number in form."
        },
        "privacy_notice_acknowledged": {
          "type": "boolean"
        }
      }
    },
    "signatures": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "proposer_signed": {
          "type": "boolean"
        },
        "proposer_name": {
          "type": "string",
          "maxLength": 200
        },
        "proposer_date": {
          "$ref": "#/$defs/date"
        },
        "agent_signed": {
          "type": "boolean"
        },
        "agent_date": {
          "$ref": "#/$defs/date"
        }
      }
    },
    "attachments": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/attachment"
      }
    }
  },
  "allOf": [
    {
      "if": {
        "properties": {
          "coverages": {
            "properties": {
              "property": {
                "properties": {
                  "by_location": {
                    "items": {
                      "properties": {
                        "business_interruption": {
                          "properties": {
                            "type": {
                              "const": "chapter_3a_daily_comp"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      "then": {}
    },
    {
      "if": {
        "properties": {
          "coverages": {
            "properties": {
              "annexes": {
                "properties": {
                  "annex_a_cyber": {
                    "properties": {
                      "selected": {
                        "const": true
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      "then": {
        "properties": {
          "coverages": {
            "properties": {
              "annexes": {
                "properties": {
                  "annex_a_cyber": {
                    "required": [
                      "limit_per_claim_and_period_ils"
                    ]
                  }
                }
              }
            }
          }
        }
      }
    }
  ]
}